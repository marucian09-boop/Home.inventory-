<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Sales & Inventory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .tab-active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        .table-container {
            max-height: 60vh;
            overflow-y: auto;
        }
        .form-input {
            transition: all 0.3s ease;
        }
        .form-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
        /* For Webkit browsers like Chrome, Safari */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Inventory Dashboard</h1>
            <p class="text-gray-500" id="currentDate"></p>
        </header>

        <!-- Main Content -->
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
            <!-- Tabs -->
            <div class="border-b border-gray-200 mb-6">
                <nav class="-mb-px flex space-x-6 overflow-x-auto" aria-label="Tabs">
                    <button onclick="changeTab('dashboard')" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-500 hover:border-blue-500 tab-active" data-tab="dashboard">Dashboard</button>
                    <button onclick="changeTab('deliveries')" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-500 hover:border-blue-500" data-tab="deliveries">Deliveries</button>
                    <button onclick="changeTab('stocks')" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-500 hover:border-blue-500" data-tab="stocks">Stocks</button>
                    <button onclick="changeTab('sales')" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-500 hover:border-blue-500" data-tab="sales">Sales Today</button>
                    <button onclick="changeTab('transferOut')" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-500 hover:border-blue-500" data-tab="transferOut">Stock Transfer Out</button>
                    <button onclick="changeTab('transferIn')" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-500 hover:border-blue-500" data-tab="transferIn">Stock Transfer In</button>
                    <button onclick="changeTab('stockLevel')" class="tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-blue-500 hover:border-blue-500" data-tab="stockLevel">Stock Level</button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div id="tab-content">
                <!-- Dashboard -->
                <div id="dashboard" class="tab-pane">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-blue-50 p-6 rounded-lg text-blue-900">
                            <h3 class="font-semibold text-lg">Daily Sales</h3>
                            <p class="text-3xl font-bold mt-2" id="dashboard-sales">₱0.00</p>
                        </div>
                        <div class="bg-green-50 p-6 rounded-lg text-green-900">
                            <h3 class="font-semibold text-lg">Total Stock Items</h3>
                            <p class="text-3xl font-bold mt-2" id="dashboard-stock">0</p>
                        </div>
                        <div class="bg-yellow-50 p-6 rounded-lg text-yellow-900">
                            <h3 class="font-semibold text-lg">Running Incentives</h3>
                            <p class="text-3xl font-bold mt-2" id="dashboard-incentives">₱0.00</p>
                        </div>
                    </div>
                </div>

                <!-- Deliveries -->
                <div id="deliveries" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold mb-4">Add New Deliveries</h2>
                    <form id="delivery-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <input type="text" id="del-imei" placeholder="15-Digit IMEI" class="form-input w-full p-2 border rounded-md" maxlength="15" required>
                        <input type="text" id="del-brand" placeholder="Brand" class="form-input w-full p-2 border rounded-md" required>
                        <input type="text" id="del-model" placeholder="Model" class="form-input w-full p-2 border rounded-md" required>
                        <input type="text" id="del-variant" placeholder="Variant (e.g., 128GB)" class="form-input w-full p-2 border rounded-md">
                        <input type="text" id="del-color" placeholder="Color" class="form-input w-full p-2 border rounded-md">
                        <input type="number" id="del-price" placeholder="Price" class="form-input w-full p-2 border rounded-md" required>
                        <input type="text" id="del-notes" placeholder="Notes" class="form-input md:col-span-2 lg:col-span-1 w-full p-2 border rounded-md">
                        <button type="submit" class="md:col-span-2 lg:col-span-3 bg-blue-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-600 transition-colors">Add to Stock</button>
                    </form>
                </div>
                
                <!-- Stocks -->
                <div id="stocks" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold mb-4">Current Stock</h2>
                    <div class="table-container">
                        <table class="min-w-full bg-white">
                            <thead class="bg-gray-100 sticky top-0">
                                <tr>
                                    <th class="py-2 px-4 border-b text-left">IMEI</th>
                                    <th class="py-2 px-4 border-b text-left">Brand</th>
                                    <th class="py-2 px-4 border-b text-left">Model</th>
                                    <th class="py-2 px-4 border-b text-left">Variant</th>
                                    <th class="py-2 px-4 border-b text-left">Color</th>
                                    <th class="py-2 px-4 border-b text-left">Price</th>
                                    <th class="py-2 px-4 border-b text-left">Notes</th>
                                </tr>
                            </thead>
                            <tbody id="stock-table-body"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Sales Today -->
                <div id="sales" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold mb-4">Record a Sale</h2>
                    <form id="sales-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <input type="text" id="sale-imei" placeholder="15-Digit IMEI of sold item" class="form-input w-full p-2 border rounded-md" maxlength="15" required>
                        <input type="number" id="sale-incentive" placeholder="Incentive" class="form-input w-full p-2 border rounded-md" required>
                        <input type="text" id="sale-notes" placeholder="Notes" class="form-input w-full p-2 border rounded-md">
                        <button type="submit" class="md:col-span-2 lg:col-span-3 bg-green-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-green-600 transition-colors">Record Sale</button>
                    </form>
                    <h3 class="text-lg font-semibold mt-8 mb-4">Today's Sales</h3>
                     <div class="table-container">
                        <table class="min-w-full bg-white">
                            <thead class="bg-gray-100 sticky top-0">
                                <tr>
                                    <th class="py-2 px-4 border-b text-left">IMEI</th>
                                    <th class="py-2 px-4 border-b text-left">Brand</th>
                                    <th class="py-2 px-4 border-b text-left">Model</th>
                                    <th class="py-2 px-4 border-b text-left">Price</th>
                                    <th class="py-2 px-4 border-b text-left">Incentive</th>
                                    <th class="py-2 px-4 border-b text-left">Notes</th>
                                </tr>
                            </thead>
                            <tbody id="sales-table-body"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Stock Transfer Out -->
                <div id="transferOut" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold mb-4">Transfer Stock Out</h2>
                    <form id="transfer-out-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <input type="text" id="tout-imei" placeholder="15-Digit IMEI" class="form-input w-full p-2 border rounded-md" maxlength="15" required>
                        <input type="text" id="tout-notes" placeholder="Notes (e.g., Destination)" class="form-input w-full p-2 border rounded-md md:col-span-2 lg:col-span-2">
                        <button type="submit" class="md:col-span-2 lg:col-span-3 bg-red-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-red-600 transition-colors">Transfer Out</button>
                    </form>
                </div>
                
                <!-- Stock Transfer In -->
                <div id="transferIn" class="tab-pane hidden">
                     <h2 class="text-xl font-semibold mb-4">Transfer Stock In</h2>
                    <form id="transfer-in-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <input type="text" id="tin-imei" placeholder="15-Digit IMEI" class="form-input w-full p-2 border rounded-md" maxlength="15" required>
                        <input type="text" id="tin-brand" placeholder="Brand" class="form-input w-full p-2 border rounded-md" required>
                        <input type="text" id="tin-model" placeholder="Model" class="form-input w-full p-2 border rounded-md" required>
                        <input type="text" id="tin-variant" placeholder="Variant" class="form-input w-full p-2 border rounded-md">
                        <input type="text" id="tin-color" placeholder="Color" class="form-input w-full p-2 border rounded-md">
                        <input type="number" id="tin-price" placeholder="Price" class="form-input w-full p-2 border rounded-md" required>
                        <input type="text" id="tin-notes" placeholder="Notes (e.g., Origin)" class="form-input md:col-span-2 lg:col-span-1 w-full p-2 border rounded-md">
                        <button type="submit" class="md:col-span-2 lg:col-span-3 bg-purple-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-purple-600 transition-colors">Transfer In</button>
                    </form>
                </div>

                <!-- Stock Level -->
                <div id="stockLevel" class="tab-pane hidden">
                    <h2 class="text-xl font-semibold mb-4">Stock Level Check</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h3 class="font-semibold text-lg text-green-700 mb-2">High Stock Products</h3>
                            <div id="high-stock-list" class="space-y-2"></div>
                        </div>
                         <div>
                            <h3 class="font-semibold text-lg text-red-700 mb-2">Low Stock Products</h3>
                            <div id="low-stock-list" class="space-y-2"></div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        
        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-5 right-5 bg-gray-800 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transition-opacity duration-300">
            <span id="toast-message"></span>
        </div>
    </div>

<script>
    // --- STATE MANAGEMENT ---
    let state = {
        inventory: [],
        sales: [],
        transfersOut: [],
        transfersIn: []
    };

    // --- UTILITY FUNCTIONS ---
    const showToast = (message, type = 'success') => {
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        toastMessage.textContent = message;

        toast.classList.remove('bg-gray-800', 'bg-red-500', 'bg-green-500');
        if (type === 'error') {
            toast.classList.add('bg-red-500');
        } else {
            toast.classList.add('bg-green-500');
        }

        toast.classList.remove('opacity-0');
        toast.classList.add('opacity-100');

        setTimeout(() => {
            toast.classList.remove('opacity-100');
            toast.classList.add('opacity-0');
        }, 3000);
    };
    
    const formatCurrency = (amount) => {
        return new Intl.NumberFormat('en-PH', { style: 'currency', currency: 'PHP' }).format(amount);
    };

    const saveState = () => {
        const today = new Date().toISOString().slice(0, 10);
        localStorage.setItem(`inventoryState_${today}`, JSON.stringify(state));
    };

    const loadState = () => {
        const today = new Date().toISOString().slice(0, 10);
        const savedState = localStorage.getItem(`inventoryState_${today}`);
        if (savedState) {
            state = JSON.parse(savedState);
        } else {
            // Clear yesterday's data if a new day starts
            state = { inventory: [], sales: [], transfersOut: [], transfersIn: [] };
        }
    };
    
    // --- TAB MANAGEMENT ---
    const changeTab = (tabName) => {
        document.querySelectorAll('.tab-pane').forEach(pane => {
            pane.classList.add('hidden');
        });
        document.getElementById(tabName).classList.remove('hidden');

        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('tab-active');
        });
        document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('tab-active');
    };

    // --- RENDERING FUNCTIONS ---
    const renderAll = () => {
        renderDashboard();
        renderStockTable();
        renderSalesTable();
        renderStockLevels();
    };

    const renderDashboard = () => {
        const totalSales = state.sales.reduce((sum, item) => sum + item.price, 0);
        const totalIncentives = state.sales.reduce((sum, item) => sum + item.incentive, 0);
        
        document.getElementById('dashboard-sales').textContent = formatCurrency(totalSales);
        document.getElementById('dashboard-stock').textContent = state.inventory.length;
        document.getElementById('dashboard-incentives').textContent = formatCurrency(totalIncentives);
    };
    
    const renderStockTable = () => {
        const tableBody = document.getElementById('stock-table-body');
        tableBody.innerHTML = '';
        if (state.inventory.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-gray-500">No items in stock.</td></tr>';
            return;
        }
        state.inventory.forEach(item => {
            const row = `
                <tr class="hover:bg-gray-50">
                    <td class="py-2 px-4 border-b">${item.imei}</td>
                    <td class="py-2 px-4 border-b">${item.brand}</td>
                    <td class="py-2 px-4 border-b">${item.model}</td>
                    <td class="py-2 px-4 border-b">${item.variant}</td>
                    <td class="py-2 px-4 border-b">${item.color}</td>
                    <td class="py-2 px-4 border-b">${formatCurrency(item.price)}</td>
                    <td class="py-2 px-4 border-b">${item.notes}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    };

    const renderSalesTable = () => {
        const tableBody = document.getElementById('sales-table-body');
        tableBody.innerHTML = '';
        if (state.sales.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-gray-500">No sales recorded today.</td></tr>';
            return;
        }
        state.sales.forEach(item => {
            const row = `
                <tr class="hover:bg-gray-50">
                    <td class="py-2 px-4 border-b">${item.imei}</td>
                    <td class="py-2 px-4 border-b">${item.brand}</td>
                    <td class="py-2 px-4 border-b">${item.model}</td>
                    <td class="py-2 px-4 border-b">${formatCurrency(item.price)}</td>
                    <td class="py-2 px-4 border-b">${formatCurrency(item.incentive)}</td>
                    <td class="py-2 px-4 border-b">${item.notes}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    };
    
    const renderStockLevels = () => {
        const highStockList = document.getElementById('high-stock-list');
        const lowStockList = document.getElementById('low-stock-list');
        highStockList.innerHTML = '';
        lowStockList.innerHTML = '';
        
        const stockCounts = state.inventory.reduce((acc, item) => {
            const key = `${item.brand} ${item.model} ${item.variant}`;
            acc[key] = (acc[key] || 0) + 1;
            return acc;
        }, {});
        
        const sortedStock = Object.entries(stockCounts).sort(([,a],[,b]) => b - a);
        
        if(sortedStock.length === 0) {
            highStockList.innerHTML = '<p class="text-gray-500">No stock to analyze.</p>';
            lowStockList.innerHTML = '<p class="text-gray-500">No stock to analyze.</p>';
            return;
        }

        const LOW_STOCK_THRESHOLD = 3;
        
        sortedStock.forEach(([name, count]) => {
            const itemHtml = `
                <div class="flex justify-between items-center bg-gray-100 p-2 rounded-md">
                    <span class="text-sm">${name}</span>
                    <span class="font-bold text-sm px-2 py-1 rounded-full ${count > LOW_STOCK_THRESHOLD ? 'bg-green-200 text-green-800' : 'bg-red-200 text-red-800'}">${count}</span>
                </div>`;

            if (count > LOW_STOCK_THRESHOLD) {
                highStockList.innerHTML += itemHtml;
            } else {
                lowStockList.innerHTML += itemHtml;
            }
        });

        if (highStockList.innerHTML === '') {
            highStockList.innerHTML = '<p class="text-gray-500">No items with high stock levels.</p>';
        }
        if (lowStockList.innerHTML === '') {
            lowStockList.innerHTML = '<p class="text-gray-500">No items with low stock levels.</p>';
        }
    };
    
    // --- EVENT HANDLERS ---
    document.getElementById('delivery-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const imei = document.getElementById('del-imei').value.trim();
        
        if(imei.length !== 15 || !/^\d+$/.test(imei)) {
            showToast('IMEI must be 15 digits.', 'error');
            return;
        }

        if (state.inventory.some(item => item.imei === imei)) {
            showToast('This IMEI already exists in stock.', 'error');
            return;
        }

        const newItem = {
            imei: imei,
            brand: document.getElementById('del-brand').value.trim(),
            model: document.getElementById('del-model').value.trim(),
            variant: document.getElementById('del-variant').value.trim(),
            color: document.getElementById('del-color').value.trim(),
            price: parseFloat(document.getElementById('del-price').value),
            notes: document.getElementById('del-notes').value.trim(),
        };
        state.inventory.push(newItem);
        saveState();
        renderAll();
        e.target.reset();
        showToast('Item added to stock successfully!');
    });
    
    document.getElementById('sales-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const imei = document.getElementById('sale-imei').value.trim();
        const itemIndex = state.inventory.findIndex(item => item.imei === imei);

        if (itemIndex === -1) {
            showToast('Item with this IMEI not found in stock.', 'error');
            return;
        }
        
        const soldItem = state.inventory[itemIndex];
        soldItem.incentive = parseFloat(document.getElementById('sale-incentive').value) || 0;
        soldItem.notes = document.getElementById('sale-notes').value.trim();
        
        state.sales.push(soldItem);
        state.inventory.splice(itemIndex, 1);
        
        saveState();
        renderAll();
        e.target.reset();
        showToast('Sale recorded successfully!');
    });

    document.getElementById('transfer-out-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const imei = document.getElementById('tout-imei').value.trim();
        const itemIndex = state.inventory.findIndex(item => item.imei === imei);

        if (itemIndex === -1) {
            showToast('Item with this IMEI not found in stock.', 'error');
            return;
        }

        const transferredItem = state.inventory[itemIndex];
        transferredItem.notes = document.getElementById('tout-notes').value.trim();

        state.transfersOut.push(transferredItem);
        state.inventory.splice(itemIndex, 1);
        
        saveState();
        renderAll();
        e.target.reset();
        showToast('Stock transferred out successfully!');
    });
    
    document.getElementById('transfer-in-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const imei = document.getElementById('tin-imei').value.trim();
        
        if(imei.length !== 15 || !/^\d+$/.test(imei)) {
            showToast('IMEI must be 15 digits.', 'error');
            return;
        }

        if (state.inventory.some(item => item.imei === imei)) {
            showToast('This IMEI already exists in stock.', 'error');
            return;
        }

        const newItem = {
            imei: imei,
            brand: document.getElementById('tin-brand').value.trim(),
            model: document.getElementById('tin-model').value.trim(),
            variant: document.getElementById('tin-variant').value.trim(),
            color: document.getElementById('tin-color').value.trim(),
            price: parseFloat(document.getElementById('tin-price').value),
            notes: document.getElementById('tin-notes').value.trim(),
        };
        state.inventory.push(newItem);
        state.transfersIn.push(newItem);
        saveState();
        renderAll();
        e.target.reset();
        showToast('Stock transferred in successfully!');
    });

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        loadState();
        renderAll();
    });
</script>

</body>
</html>
